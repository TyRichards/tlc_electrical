(function(f){f.justifiedImageGrid=function(k,a){var j=this,g=f(k),n=f.browser.msie;j.init=function(){a.minHeight=a.targetHeight-a.heightDeviation;a.maxHeight=a.targetHeight+a.heightDeviation;a.defaultHeightRatio=a.targetHeight/a.maxHeight;if("no"!=a.lightbox&&"links-off"!=a.lightbox)switch(a.linkClass=""!=a.linkClass?' class="'+a.linkClass+'" ':"",a.linkRel){case "auto":switch(a.lightbox){case "prettyphoto":a.linkRel=' rel="prettyPhoto['+a.instance+']" ';break;case "colorbox":a.linkRel=' rel="colorBox['+ a.instance+']" ';break;case "custom":a.linkRel=' rel="gallery['+a.instance+']" '}break;case "":a.linkRel="";break;default:a.linkRel=' rel="'+a.linkRel+'" '}else a.linkClass="",a.linkRel="";a.allItems=a.items.slice();a.hiddenOpacity=!n?0:0.01;a.errorChecked=!1;a.loadSuccess=0;a.loadError=0;a.errorImages=[];j.createGallery();var d=p=i=e=h=l=function(){return!1},b=function(b,c,d){b.find(c).hoverFlow(d,{opacity:"show"},a.animSpeed)},c=function(b,c,d){b.find(c).hoverFlow(d,{opacity:"hide"},a.animSpeed)}; switch(a.overlay){case "hovered":var d=function(a){b(a,"div.jig-overlay-wrapper","mouseenter")},e=function(a){c(a,"div.jig-overlay-wrapper","mouseleave")};break;case "others":d=function(a){c(a,"div.jig-overlay-wrapper","mouseenter")},e=function(a){b(a,"div.jig-overlay-wrapper","mouseleave")}}if(n)switch(a.desaturate){case "others":p=function(b){b.find(".jig-desaturated").hoverFlow("mouseenter",{opacity:0.01},a.animSpeed)};h=function(b){b.find(".jig-desaturated").hoverFlow("mouseleave",{opacity:1}, a.animSpeed)};break;case "hovered":p=function(b){b.find(".jig-desaturated").hoverFlow("mouseenter",{opacity:1},a.animSpeed)},h=function(b){b.find(".jig-desaturated").hoverFlow("mouseleave",{opacity:0.01},a.animSpeed)}}else switch(a.desaturate){case "others":var p=function(a){c(a,".jig-desaturated","mouseenter")},h=function(a){b(a,".jig-desaturated","mouseleave")};break;case "hovered":p=function(a){b(a,".jig-desaturated","mouseenter")},h=function(a){c(a,".jig-desaturated","mouseleave")}}switch(a.caption){case "fade":var i= function(a){b(a,"div.jig-caption","mouseenter")},l=function(a){c(a,"div.jig-caption","mouseleave")};break;case "slide":n?(i=function(a){b(a,"div.jig-caption","mouseenter")},l=function(a){c(a,"div.jig-caption","mouseleave")}):(i=function(b){b.find("div.jig-caption").hoverFlow("mouseenter",{height:"show"},a.animSpeed)},l=function(b){b.find("div.jig-caption").hoverFlow("mouseleave",{height:"hide"},a.animSpeed)});break;case "mixed":i=function(b){b.find("div.jig-caption-description-wrapper").hoverFlow("mouseenter", {height:"show"},a.animSpeed)},l=function(b){b.find("div.jig-caption-description-wrapper").hoverFlow("mouseleave",{height:"hide"},a.animSpeed)}}g.on("mouseenter mouseleave","a",function(a){var b=f(this);"none"!=b.css("display")&&(a.stopImmediatePropagation(),"mouseenter"===a.type?(d(b),p(b),i(b),b.data("title",b.attr("title")),b.removeAttr("title")):(e(b),h(b),l(b),b.attr("title",b.data("title"))))});g.on("mousedown","a",function(){f(this).attr("title",f(this).data("title"))})};j.createGallery=function(d){g.css("width", "").css("width",g.width());var b=g.width()-1;a.justResized=!1;if(d&&"resize"==d){if(a.areaWidth&&a.areaWidth==b)return;a.justResized=!0}g.find(".jig-overflow a *:not(div)").off();a.areaWidth=b;a.row=[];a.fullWidth=a.extra=0;a.rows=[];a.items=a.allItems.slice();if(!0==a.errorChecked&&!1==a.justResized){for(var c in a.items)-1!=f.inArray(a.items[c].url,a.errorImages)&&a.items.splice(c,1);a.allItems=a.items.slice();a.errorImages=[];a.errorChecked=!1}if(""==a.maxRows||0==a.maxRows)a.maxRows=1E3;a.rowcount= 0;for(a.imagesShown=0;0<a.items.length&&a.rowcount<a.maxRows;)a.rows.push(o()),a.rowcount++;a.imagesShown+=a.allItems.length-a.items.length;g.find(".jig-imageContainer:gt("+(a.imagesShown-1)+")").remove();a.imagesAlreadyAdded=g.find(".jig-imageContainer").length;var d=0,e;for(e in a.rows)for(var i in a.rows[e])if(d++,b=a.rows[e][i],b.container&&d<=a.imagesAlreadyAdded)i==a.rows[e].length-1?b.container.css("margin-right",0):b.container.css("margin-right",""),c=b.overflow,c.css("width",(b.containerWidth? b.containerWidth:b.newWidth)+"px"),c.css("height",(b.containerHeight?b.containerHeight:b.newHeight)+"px"),c=b.img,c.css("width",b.newWidth+"px"),c.css("height",b.newHeight+"px"),b.marLeft?c.css("margin-left",-b.marLeft+"px"):c.css("margin-left",""),"off"!=a.desaturate&&q(c.siblings(".jig-desaturated"),c);else{var h=a.rows[e].length,k=i;if(!isNaN(b.newWidth)){b.title=b.title?b.title:"";b.caption=b.caption?b.caption:"";b.description=b.description?b.description:"";b.alternate=b.alternate?b.alternate: "";b.link=b.link?b.link:"";c=f('<div class="jig-imageContainer"/>');var l=f('<div class="jig-overflow"/>'),m=b.url;linkClass=a.linkClass;linkRel=a.linkRel;b.link&&(m=b.link,linkClass=' class="jig-customLink" ',linkRel="");link=f("<a"+linkClass+linkRel+' title="'+b[a.linkTitleField]+'" href="'+("links-off"!=a.lightbox?m:"#")+'"/>');img=f("<img/>");link.hide();k==h-1&&c.css("margin-right",0);l.css("width",(b.containerWidth?b.containerWidth:b.newWidth)+"px");l.css("height",(b.containerHeight?b.containerHeight: b.newHeight)+"px");ext="";h=b.url;2<h.lastIndexOf(".")&&(ext="&f="+h.substring(h.lastIndexOf(".")));img.attr("src",a.timthumb+"?src="+h+"&h="+a.maxHeight+"&q="+a.quality+ext);img.attr("alt",b[a.imgAltField]);img.css("width",b.newWidth+"px");img.css("height",b.newHeight+"px");b.marLeft&&img.css("margin-left",-b.marLeft+"px");img.css("margin-top",0);link.append(img);"off"!=a.overlay&&link.append('<div class="jig-overlay-wrapper"><div class="jig-overlay"></div></div>');"off"!=a.caption&&(h="",""!=b[a.titleField]&& (h+='<div class="jig-caption-title">'+b[a.titleField]+"</div>"),""!=b[a.captionField]&&(h+='<div class="jig-caption-description-wrapper"><div class="jig-caption-description'+(""!=h?"":" jig-alone")+'">'+b[a.captionField]+"</div></div>"),""!=h&&(h='<div class="jig-caption-wrapper"><div class="jig-caption">'+h+"</div></div>",link.append(h)));l.append(link);c.append(l);g.find(".jig-clearfix").before(c);b.container=c;b.overflow=l;b.img=img}}g.css("width","").css("width",g.width());a.areaWidth!=g.width()- 1&&(j.createGallery("resize"),1<a.instance&&f("#jig"+(a.instance-1)).data("justifiedImageGrid").createGallery("resize"));f("img",g).load(function(){var b=f(this).closest("a");if(b.length!=0&&b.hasClass("jig-loaded")!==true){b.addClass("jig-loaded");a.testTx="nullx";b.css("display")=="none"&&b.fadeIn(a.animSpeed);if(a.errorChecking=="yes"){a.loadSuccess++;r()}a.desaturate!="off"&&f(this).clone().addClass("jig-desaturated").insertAfter(f(this)).load(function(){if(f(this).hasClass("jig-desat-complete")!== true){var b=f(this).parent();f(this).stop().css("display","block").css("opacity",1);Pixastic.process(this,"desaturate",{average:false});a.desaturate=="hovered"&&(n?b.find(".jig-desaturated").css("opacity",a.hiddenOpacity):b.find(".jig-desaturated").css("display","none").css("opacity",1));f(this).addClass("jig-desat-complete")}else f(this).off("load")}).each(function(){(this.complete||this.naturalWidth!=void 0&&this.naturalWidth!=0)&&f(this).trigger("load")})}else f(this).off("load")}).error(function(){if(a.errorChecking== "yes"){var b=/(?:\?src=)(.*)(?:&h=)/g.exec(f(this).attr("src"));a.errorImages.push(b[1]);f(this).closest(".jig-imageContainer").addClass("jig-unloadable");a.loadError++;r()}}).each(function(){(this.complete||this.naturalWidth!=void 0&&this.naturalWidth!=0)&&f(this).trigger("load")});f.browser.msie&&(8>f.browser.version&&"off"!=a.overlay)&&f(".jig-overlay").css({position:"absolute",bottom:0,left:0,right:0,top:0});switch(a.lightbox){case "prettyphoto":case "colorbox":a.lightboxInit();break;case "links-off":g.find("a").css("cursor", "default"),g.on("click","a",function(a){a.preventDefault()})}};var o=function(){a.row=[];a.fullWidth=0;for(a.extra=0;0<a.items.length&&a.extra<a.areaWidth;){var d=a.items.shift();d.newHeight=d.newWidth=d.containerHeight=d.containerWidth=d.marLeft=void 0;d.ratio=d.width/a.maxHeight;a.row.push(d);a.fullWidth+=Math.round(d.width*a.defaultHeightRatio)+a.margins;a.extra=a.fullWidth-a.margins}a.extra-=a.areaWidth;if(0<a.row.length&&0<a.extra||0==a.rows.length){var b="landscape",c;for(c in a.row)if(1>a.row[c].ratio){b= "portrait";break}if("landscape"==b)a:{c=!0;a.marginsTotal=(a.row.length-1)*a.margins;a.rowlen=0;a.heights=[];for(var e in a.row){b=Math.round(a.row[e].width*a.defaultHeightRatio);d=Math.round((b+a.marginsTotal/a.row.length)/a.fullWidth*a.extra);a.row[e].newWidth=b-d;a.heights[e]=a.row[e].newWidth/a.row[e].ratio;if(a.heights[e]<a.minHeight){m();break a}a.heights[e]>a.maxHeight?(a.row[e].newHeight=a.targetHeight,a.row[e].newWidth=Math.round(a.row[e].newHeight*a.row[e].ratio),c=!1):(a.row[e].newHeight= a.heights[e],a.rowlen+=a.row[e].newWidth)}c&&(a.remaining=a.rowlen+a.marginsTotal-a.areaWidth,i())}else m()}else if(0==a.items.length)switch(a.incompleteLastRow){case "hide":m("hide");break;case "match":e=0;for(b in a.rows)e=b;b=a.rows[e][0].containerHeight?a.rows[e][0].containerHeight:a.rows[e][0].newHeight;a.marginsTotal=(a.row.length-1)*a.margins;a.rowlen=0;for(c in a.row)void 0!=a.rows[e][c]&&a.row[c].width==a.rows[e][c].width?(a.row[c].newHeight=a.rows[e][c].newHeight,a.row[c].containerHeight= a.rows[e][c].containerHeight,a.row[c].newWidth=a.rows[e][c].newWidth,a.row[c].containerWidth=a.rows[e][c].containerWidth,a.row[c].marLeft=a.rows[e][c].marLeft):(a.row[c].newHeight=b,a.row[c].newWidth=Math.round(a.row[c].newHeight*a.row[c].ratio)),a.rowlen+=a.row[c].newWidth;b>a.targetHeight&&(a.remaining=a.rowlen+a.marginsTotal-a.areaWidth,0<a.remaining&&i());break;default:m("lastRow")}else for(c in a.row)d=a.row[c],d.marLeft=0,d.newHeight=a.targetHeight,d.newWidth=Math.round(d.newHeight*d.ratio); return a.row},m=function(d){var b=!0;if(1!=a.row.length&&void 0==d){var c=a.row.pop();a.fullWidth-=Math.round(c.width*a.defaultHeightRatio)+a.margins;a.items.unshift(c);a.extra=a.fullWidth-a.margins;a.extra-=a.areaWidth}a.marginsTotal=(a.row.length-1)*a.margins;a.rowlen=0;a.heights=[];for(var e in a.row){var c=Math.round(a.row[e].width*a.defaultHeightRatio),f=Math.round((c+a.marginsTotal/a.row.length)/a.fullWidth*a.extra);a.row[e].newWidth=c-f;a.heights[e]=a.row[e].newWidth/a.row[e].ratio;if(a.heights[e]> a.maxHeight){if(void 0==d){d=a.items.shift();a.row.push(d);a.fullWidth+=Math.round(d.width*a.defaultHeightRatio)+a.margins;a.extra=a.fullWidth-a.margins;a.extra-=a.areaWidth;s();return}if("lastRow"==d){a.row[e].newHeight=a.targetHeight;a.row[e].newWidth=Math.round(a.row[e].newHeight*a.row[e].ratio);b=!1;continue}else a.row[e].newWidth=void 0,a.imagesShown--,b=!1}else if(a.heights[e]<a.minHeight&&void 0==d){s();return}void 0!=a.row[e].newWidth&&(a.row[e].newHeight=a.heights[e],a.rowlen+=a.row[e].newWidth)}b&& (a.remaining=a.rowlen+a.marginsTotal-a.areaWidth,i())},i=function(){if(0!=a.remaining)if(0<a.remaining)for(;0<a.remaining;)for(var d in a.row){if(a.row[d].newWidth--,a.row[d].newHeight=a.heights[d]=a.row[d].newWidth/a.row[d].ratio,a.remaining--,0==a.remaining)break}else for(;0>a.remaining;)for(d in a.row)if(a.row[d].newWidth++,a.row[d].newHeight=a.heights[d]=a.row[d].newWidth/a.row[d].ratio,a.remaining++,0==a.remaining)break;a.heights.sort(function(a,b){return a-b});var b=Math.floor(a.heights[0]); for(d in a.row)a.row[d].containerHeight=b,a.row[d].newHeight=Math.round(a.row[d].newHeight)},s=function(){var d=[],b=0;a.marginsTotal=(a.row.length-1)*a.margins;for(var c in a.row){var e=a.row[c],f=Math.round(a.row[c].width*a.defaultHeightRatio);e.newHeight=a.targetHeight;e.newWidth=f;d[c]=Math.round((f+a.marginsTotal/a.row.length)/a.fullWidth*a.extra);b+=d[c]}b=a.extra-b;if(0!=b)if(0<b)for(;0<b;)for(c in d){if(d[c]++,b--,0==b)break}else for(;0>b;)for(c in d)if(d[c]--,b++,0==b)break;for(var h in a.row)c= d[h],b=a.row[h],b.marLeft=Math.round(c/2),b.containerWidth=b.newWidth-c},q=function(d,b){0!=d.length?(d.addClass("jig-removeThis"),b.clone().addClass("jig-desaturated").insertAfter(b).load(function(){!0!==f(this).hasClass("jig-desat-complete")?(f(this).stop().css("display","block").css("opacity",1),Pixastic.process(this,"desaturate",{average:!1}),"hovered"==a.desaturate?n?b.next().css("opacity",a.hiddenOpacity):b.next().css("display","none").css("opacity",1):b.next().css("opacity",1),f(this).addClass("jig-desat-complete"), b.siblings(".jig-removeThis").remove()):f(this).off("load")}).each(function(){(this.complete||void 0!=this.naturalWidth&&0!=this.naturalWidth)&&f(this).trigger("load")})):b.load(function(){q(d,b)})};a.errorChecked=!1;var r=function(){if(f(".jig-loaded").length==a.imagesShown||f(".jig-loaded").length+a.loadError==a.imagesShown)0!=a.loadError?(a.loadSuccess=0,a.loadError=0,a.errorChecked=!0,g.find(".jig-unloadable").remove(),j.createGallery("errorCheck")):(a.loadSuccess=0,a.loadError=0)};j.init()}; f.fn.justifiedImageGrid=function(k){return this.each(function(){if(void 0==f(this).data("justifiedImageGrid")){var a=new f.justifiedImageGrid(this,k);f(this).data("justifiedImageGrid",a)}})}})(jQuery); (function(f){f.fn.hoverFlow=function(k,a,j,g,n){if(-1==f.inArray(k,["mouseover","mouseenter","mouseout","mouseleave"]))return this;var o="object"===typeof j?j:{complete:n||!n&&g||f.isFunction(j)&&j,duration:j,easing:n&&g||g&&!f.isFunction(g)&&g};o.queue=!1;var m=o.complete;o.complete=function(){f(this).dequeue();f.isFunction(m)&&m.call(this)};return this.each(function(){var g=f(this);"mouseover"==k||"mouseenter"==k?g.data("jQuery.hoverFlow",!0):g.removeData("jQuery.hoverFlow");g.queue(function(){("mouseover"== k||"mouseenter"==k?void 0!==g.data("jQuery.hoverFlow"):void 0===g.data("jQuery.hoverFlow"))?g.animate(a,o):g.queue([])})})}})(jQuery);